
# System Programming Project README

## 개요
본 프로젝트는 이미지 처리에서 **합성곱(Convolution) 연산**을 고속화하기 위해 다양한 최적화 기법을 적용한 결과를 다룹니다. 특히 4×4 블록 단위 합성곱을 중심으로, 인라인 함수화·데이터 지역성 향상·루프 전개 등 기법을 병행하여 기존 구현 대비 최대 **4.8 배** 속도 향상을 달성하였습니다.


## 핵심 최적화 기법
### 1. 인라인 함수화
- 모든 보조 함수를 `inline`화하여 함수 호출 오버헤드 제거.
- `convolution_block`은 함수 크기가 크지만, 실행 성능 우선 고려로 인라인 유지.

### 2. 데이터 지역성 향상
- **x-우선 루프 순서**로 변경해 캐시 적중률 향상.
- 루프 내부에서 반복 계산되는 `x + y * width` 계수를 외부 변수로 캐싱.

### 3. 오버플로 방지 및 분기 최적화
- RGB 값 범위(0–255) 검사 시 **분기 구조 단순화**.
- `if-else if` 체계를 사용해 불필요한 중복 연산 제거.

### 4. 4×4 블록 합성곱 (`convolution_block`)
- 4×4 픽셀을 동시에 처리하기 위해 6×6 입력 창을 한 번에 로드.
- 필터 계수와 입력 픽셀 접근을 **최소화**해 메모리 병목 감소.
- 8×8 블록은 캐시 미스 증가로 오히려 성능 하락 ⇒ 4×4가 최적.

### 5. 경계 조건 분리
- 가장자리·코너 → `convolution` (안전 우선)
- 내부 3열 → `convolution_in` (분기 제거)
- 그 외 영역 → `convolution_block`

## 벤치마크 결과 (Sharpen 필터, 20회 평균)
| 이미지 크기 | 기본 대비 속도배수<br>`convolution_in`<br>(Unroll=8) | 4×4 블록 | 8×8 블록 |
|-------------|-------------------------------|-----------|-----------|
| 128×128 | 3.76× | **4.25×** | 4.13× |
| 256×256 | 3.42× | **4.20×** | 4.13× |
| 512×512 | 3.95× | **4.80×** | 4.60× |
| 768×768 | 3.79× | **4.60×** | 4.54× |
| 1024×1024 | 3.42× | **4.55×** | 4.43× |

> **관찰**: 512×512 해상도에서 최대 성능이 나타났으며, 이는 캐시 사용 패턴과 블록 크기의 균형이 가장 좋았기 때문으로 분석됩니다.

## 한계 및 향후 과제
1. **SIMD**: 구조체 기반 RGB 로드/스토어 병목으로 현재 SIMD 구현이 오히려 느림. 구조 재설계 및 얼라인먼트 최적화 필요.
2. **대칭·정수 필터 특화**: 필터 계수가 대칭·정수 합 1인 경우 고정소수점 및 범위 체크 생략으로 추가 가속 가능.
3. **멀티스레딩**: 현재 단일 스레드. OpenMP 등을 통한 멀티코어 활용 여지 존재.

## 라이선스

---
**작성자** : 201911050 도담록

